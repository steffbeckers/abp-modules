# ASP.NET Core
# Build and test ASP.NET Core projects targeting .NET Core.
# Add steps that run tests, create a NuGet package, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/dotnet-core

trigger:
  - main

pool:
  vmImage: ubuntu-latest

variables:
  buildConfiguration: "Release"

steps:
  # Restore NuGet packages
  - task: DotNetCoreCLI@2
    displayName: Restore projects NuGet packages
    inputs:
      command: restore
      projects: "**/*.csproj"
      includeNuGetOrg: true
  # Build projects
  - task: DotNetCoreCLI@2
    displayName: Build projects
    inputs:
      command: build
      projects: "**/*.csproj"
      arguments: "--configuration $(buildConfiguration)"
  # Test projects
  - task: DotNetCoreCLI@2
    displayName: Test projects
    inputs:
      command: test
      projects: "**/test/**/*.Tests.csproj"
      arguments: "--configuration $(buildConfiguration)"
  # Publish test results
  - task: PublishTestResults@2
    displayName: Publish test results
    condition: succeededOrFailed()
    inputs:
      testRunner: VSTest
      testResultsFiles: "**/*.trx"
  # Pack projects
  - task: DotNetCoreCLI@2
    displayName: Pack projects as NuGet package
    inputs:
      command: pack
      projects: "**/src/*.csproj"
  # Authenticate with NuGet
  - task: NuGetAuthenticate@0
    displayName: Authenticate with NuGet
    inputs:
      nuGetServiceConnections: 'NuGetSteffBeckers'
  # Push packages to NuGet
  - task: NuGetCommand@2
    displayName: Push packages to NuGet
    inputs:
      command: push